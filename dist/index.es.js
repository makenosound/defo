function e({prefix:e,scope:r,views:o}){Object.keys(o).forEach(n=>{const s=`data-${e}-${function(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}(n)}`;let i=Array.prototype.slice.call(r.querySelectorAll(`[${s}]`));r.hasAttribute(s)&&(i=[r].concat(i)),i.forEach(r=>{t(r,e,o,n)})})}function t(e,t,o,n){if(e._defoUpdate&&e._defoUpdate[n])return;const s=o[n];if(!s)return;const i=s(e,r(e.dataset[function(e,t){return`${e}${t.charAt(0).toUpperCase()+t.slice(1)}`}(t,n)]));e._defoUpdate=e._defoUpdate||{},e._defoDestroy=e._defoDestroy||{},e._defoUpdate[n]=function(e){return function(t,o){t=t?r(t):t,o=o?r(o):o,Promise.resolve(e).then(e=>{e.update&&e.update(t,o)})}}(i),e._defoDestroy[n]=function(e,t,r){return function(){Promise.resolve(e).then(e=>{e.destroy&&(e.destroy(),delete t._defoUpdate[r],delete t._defoDestroy[r])})}}(i,e,n)}function r(e){return/^({|\[)/.test(e)&&(e=JSON.parse(e)),e}function o({prefix:r,scope:o,views:n}){e({prefix:r,scope:o,views:n});const s=new window.MutationObserver(o=>{o.forEach(o=>{const s=o.target;if("attributes"===o.type&&function(e,t){return 0===e.indexOf(`data-${t}`)}(o.attributeName,r)){const e=function(e){return e.split("-").slice(2).map((e,t)=>t>0?e.charAt(0).toUpperCase()+e.slice(1):e).join("")}(o.attributeName);s.hasAttribute(o.attributeName)?null!==o.oldValue?s._defoUpdate[e](s.getAttribute(o.attributeName),o.oldValue):t(s,r,n,e):s._defoDestroy[e]()}else"childList"===o.type&&(Array.prototype.slice.call(o.removedNodes).filter(e=>(function(e,t){return function(e,t){return Object.keys(e.dataset).filter(e=>0===e.indexOf(t))}(e,t).length>0})(e,r)).forEach(e=>{Object.keys(e._defoDestroy).forEach(t=>{e._defoDestroy[t]()})}),Array.prototype.slice.call(o.addedNodes).forEach(t=>{Promise.resolve(t).then(t=>{e({prefix:r,scope:t,views:n})})}))})});return s.observe(o,{attributes:!0,attributeOldValue:!0,childList:!0,characterData:!1,subtree:!0}),s}export default function({prefix:e="defo",scope:t=document.documentElement,views:r={}}={}){return o({prefix:e,scope:t,views:r}),{registerViews:e=>r=function(e,t){return Object.assign(Object.assign({},e),t)}(r,e),unregisterViews:e=>r=function(e,t){const r={};return Object.keys(e).forEach(o=>{-1===t.indexOf(o)&&(r[o]=e[o])}),r}(r,e)}}
