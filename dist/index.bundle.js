!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Defo=t()}(this,(function(){"use strict";function e(e,t){return function(e,t){return Object.keys(e.dataset).filter(e=>0===e.indexOf(t))}(e,t).length>0}function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}function r(e){try{return JSON.parse(e)}catch(e){}return e}function o({prefix:e,scope:t,views:r}){Object.keys(r).forEach(o=>{const s=`data-${e}-${function(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}(o)}`;let i=Array.prototype.slice.call(t.querySelectorAll(`[${s}]`));t.hasAttribute(s)&&(i=[t].concat(i)),i.forEach(t=>{n(t,e,r,o)})})}function n(e,o,n,s){if(e._defoUpdate&&e._defoUpdate[s])return;const i=n[s],c=function(e,r){return`${o=e,o.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(e,t)=>t.toUpperCase()).replace(/\d+(\w|$)/g,e=>e.toUpperCase())}${t(r)}`;var o}(o,s);if(!(i&&c in e.dataset))return;const a=i(e,r(e.dataset[c]));e._defoUpdate=e._defoUpdate||{},e._defoDestroy=e._defoDestroy||{},e._defoUpdate[s]=function(e){return function(t,o){t=t?r(t):t,o=o?r(o):o,Promise.resolve(e).then(e=>{e.update&&e.update(t,o)})}}(a),e._defoDestroy[s]=function(e,t,r){return function(){Promise.resolve(e).then(e=>{e.destroy&&(e.destroy(),delete t._defoUpdate[r],delete t._defoDestroy[r])})}}(a,e,s)}function s({prefix:r,scope:s,views:i}){o({prefix:r,scope:s,views:i});const c=new MutationObserver(s=>{s.forEach(s=>{const c=s.target;if("attributes"===s.type&&function(e,t){return 0===e.indexOf(`data-${t}-`)}(s.attributeName,r)){const e=function(e){return e.split("-").slice(2).map((e,r)=>r>0?t(e):e).join("")}(s.attributeName);c.hasAttribute(s.attributeName)?null!==s.oldValue?c._defoUpdate[e](c.getAttribute(s.attributeName),s.oldValue):n(c,r,i,e):c._defoDestroy[e]()}else"childList"===s.type&&(console.log(s),Array.prototype.slice.call(s.removedNodes).filter(e=>e.nodeType!==e.TEXT_NODE).filter(t=>e(t,r)).forEach(e=>{Object.keys(e._defoDestroy).forEach(t=>{e._defoDestroy[t]()})}),Array.prototype.slice.call(s.addedNodes).filter(e=>e.nodeType!==e.TEXT_NODE).forEach(e=>{Promise.resolve(e).then(e=>{o({prefix:r,scope:e,views:i})})}))})});return c.observe(s,{attributes:!0,attributeOldValue:!0,childList:!0,characterData:!1,subtree:!0}),c}return function({prefix:e="defo",scope:t=document.documentElement,views:r={}}={}){const o=s({prefix:e,scope:t,views:r});return{registerViews:e=>r=function(e,t){return Object.assign(Object.assign({},e),t)}(r,e),unregisterViews:e=>r=function(e,t){const r={};return Object.keys(e).forEach(o=>{-1===t.indexOf(o)&&(r[o]=e[o])}),r}(r,e),destroy:()=>{o.disconnect()}}}}));
