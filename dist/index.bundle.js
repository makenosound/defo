!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Defo=t()}(this,(function(){"use strict";function e({prefix:e,scope:r,views:o}){Object.keys(o).forEach(n=>{const i=`data-${e}-${function(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}(n)}`;let s=Array.prototype.slice.call(r.querySelectorAll(`[${i}]`));r.hasAttribute(i)&&(s=[r].concat(s)),s.forEach(r=>{t(r,e,o,n)})})}function t(e,t,o,n){if(e._defoUpdate&&e._defoUpdate[n])return;const i=o[n];if(!i)return;const s=i(e,r(e.dataset[function(e,t){return`${e}${t.charAt(0).toUpperCase()+t.slice(1)}`}(t,n)]));e._defoUpdate=e._defoUpdate||{},e._defoDestroy=e._defoDestroy||{},e._defoUpdate[n]=function(e){return function(t,o){t=t?r(t):t,o=o?r(o):o,Promise.resolve(e).then(e=>{e.update&&e.update(t,o)})}}(s),e._defoDestroy[n]=function(e,t,r){return function(){Promise.resolve(e).then(e=>{e.destroy&&(e.destroy(),delete t._defoUpdate[r],delete t._defoDestroy[r])})}}(s,e,n)}function r(e){return/^({|\[)/.test(e)&&(e=JSON.parse(e)),e}function o({prefix:r,scope:o,views:n}){e({prefix:r,scope:o,views:n});const i=new window.MutationObserver(o=>{o.forEach(o=>{const i=o.target;if("attributes"===o.type&&function(e,t){return 0===e.indexOf(`data-${t}`)}(o.attributeName,r)){const e=function(e){return e.split("-").slice(2).map((e,t)=>t>0?e.charAt(0).toUpperCase()+e.slice(1):e).join("")}(o.attributeName);i.hasAttribute(o.attributeName)?null!==o.oldValue?i._defoUpdate[e](i.getAttribute(o.attributeName),o.oldValue):t(i,r,n,e):i._defoDestroy[e]()}else"childList"===o.type&&(Array.prototype.slice.call(o.removedNodes).filter(e=>!e.TEXT_NODE).filter(e=>(function(e,t){return function(e,t){return Object.keys(e.dataset).filter(e=>0===e.indexOf(t))}(e,t).length>0})(e,r)).forEach(e=>{Object.keys(e._defoDestroy).forEach(t=>{e._defoDestroy[t]()})}),Array.prototype.slice.call(o.addedNodes).filter(e=>!e.TEXT_NODE).forEach(t=>{Promise.resolve(t).then(t=>{e({prefix:r,scope:t,views:n})})}))})});return i.observe(o,{attributes:!0,attributeOldValue:!0,childList:!0,characterData:!1,subtree:!0}),i}return function({prefix:e="defo",scope:t=document.documentElement,views:r={}}={}){return o({prefix:e,scope:t,views:r}),{registerViews:e=>r=function(e,t){return Object.assign(Object.assign({},e),t)}(r,e),unregisterViews:e=>r=function(e,t){const r={};return Object.keys(e).forEach(o=>{-1===t.indexOf(o)&&(r[o]=e[o])}),r}(r,e)}}}));
